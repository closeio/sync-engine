version: 2.1
jobs:
  build:
    machine: true
    working_directory: ~/inbox

    steps:
      - checkout

      - setup_remote_docker

      - run:
          name: build nylas image
          command: docker-compose build nylas

      - run:
          name: run tests
          command: |
            docker-compose run nylas bash -ec '
              bin/wait-for-it.sh mysql:3306 \
              && NYLAS_ENV=test py.test inbox/test/
            '
