version: 2.1
jobs:
  build:
    machine:
      image: ubuntu-1604:201903-01 
    working_directory: ~/inbox

    steps:
      - checkout

      - run:
          name: build nylas image
          command: docker-compose build nylas

      - run:
          name: run tests
          command: |
            docker-compose run nylas bash -ec '
              pip install -e . \
              && bin/wait-for-it.sh mysql:3306 \
              && NYLAS_ENV=test py.test inbox/test/
            '
