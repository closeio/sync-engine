#!/usr/bin/env python
"""Watches a redis priority queue for deferred account migrations to execute."""

import gevent.monkey

gevent.monkey.patch_all()

from setproctitle import setproctitle

from inbox.error_handling import maybe_enable_rollbar
from inbox.logging import configure_logging
from inbox.scheduling.deferred_migration import DeferredAccountMigrationExecutor

configure_logging()


def main():
    setproctitle('deferred-migration-service')

    maybe_enable_rollbar()

    print "Starting DeferredAccountMigrationExecutor..."
    dame = DeferredAccountMigrationExecutor()
    dame.start()
    print "Done"
    dame.join()


if __name__ == '__main__':
    main()
